"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.errorMessages = exports.rule = exports.name = void 0;

var _experimentalUtils = require("@typescript-eslint/experimental-utils");

var _astUtils = require("eslint/lib/rules/utils/ast-utils");

var _astUtils2 = require("../utils/ast-utils");

//
// ─── RULE DECLARATIONS ──────────────────────────────────────────────────────────
//
const name = 'jq-cache-dom-elements';
exports.name = name;

const createRule = _experimentalUtils.ESLintUtils.RuleCreator(() => 'https://github.com/fullstack-development/front-end-best-practices/blob/master/JS/jQuery.md');

const errorMessages = {
  cacheDOMNodes: 'Selector {{ selector }} was used {{ times }} times. Try caching this DOM node instead'
};
exports.errorMessages = errorMessages;
const meta = {
  type: 'suggestion',
  docs: {
    category: 'Best Practices',
    description: 'Cache all selected DOM elements',
    recommended: false
  },
  messages: errorMessages,
  schema: []
};
const jqDOMSelector = 'MemberExpression > CallExpression > Identifier.callee[name=/\\$|(jQuery)/]';
const rule = createRule({
  name,
  meta,
  defaultOptions: [],

  create(context) {
    const scopeToSelectors = {};
    return {
      [jqDOMSelector]: function checkDOMSelector(node) {
        const functionAncestor = (0, _astUtils2.getAncestorOfType)(_astUtils.isFunction, node);
        const scopeId = functionAncestor ? `${functionAncestor.range.join(',')}` // no 2 functions can have same range
        : 'global';
        const callExpression = node.parent;
        const firstArg = callExpression.arguments[0];

        if (firstArg.type === _experimentalUtils.AST_NODE_TYPES.Literal) {
          if (!firstArg.value) return;
          const selector = firstArg.value.toString(); // if selector is html element string

          if (selector.startsWith('<')) return;
          const scope = scopeToSelectors[scopeId];
          const isSelectorInScope = scope && scope[selector];

          if (isSelectorInScope) {
            scopeToSelectors[scopeId][selector].push(callExpression);
          } else if (scope) {
            scope[selector] = [callExpression];
            scopeToSelectors[scopeId] = scope;
          } else {
            scopeToSelectors[scopeId] = {
              [selector]: [callExpression]
            };
          }
        }
      },
      'Program:exit': function reportIfRepeatedSelectionsFound() {
        Object.entries(scopeToSelectors).forEach(([, selectorToNodes]) => {
          Object.entries(selectorToNodes).forEach(([selector, nodes]) => {
            if (nodes.length > 1) {
              context.report({
                messageId: 'cacheDOMNodes',
                node: nodes[0],
                data: {
                  selector,
                  times: nodes.length
                }
              });
            }
          });
        });
      }
    };
  }

});
exports.rule = rule;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvcnVsZXMvanEtY2FjaGUtZG9tLWVsZW1lbnRzLnRzIl0sIm5hbWVzIjpbIm5hbWUiLCJjcmVhdGVSdWxlIiwiRVNMaW50VXRpbHMiLCJSdWxlQ3JlYXRvciIsImVycm9yTWVzc2FnZXMiLCJjYWNoZURPTU5vZGVzIiwibWV0YSIsInR5cGUiLCJkb2NzIiwiY2F0ZWdvcnkiLCJkZXNjcmlwdGlvbiIsInJlY29tbWVuZGVkIiwibWVzc2FnZXMiLCJzY2hlbWEiLCJqcURPTVNlbGVjdG9yIiwicnVsZSIsImRlZmF1bHRPcHRpb25zIiwiY3JlYXRlIiwiY29udGV4dCIsInNjb3BlVG9TZWxlY3RvcnMiLCJjaGVja0RPTVNlbGVjdG9yIiwibm9kZSIsImZ1bmN0aW9uQW5jZXN0b3IiLCJpc0Z1bmN0aW9uIiwic2NvcGVJZCIsInJhbmdlIiwiam9pbiIsImNhbGxFeHByZXNzaW9uIiwicGFyZW50IiwiZmlyc3RBcmciLCJhcmd1bWVudHMiLCJBU1RfTk9ERV9UWVBFUyIsIkxpdGVyYWwiLCJ2YWx1ZSIsInNlbGVjdG9yIiwidG9TdHJpbmciLCJzdGFydHNXaXRoIiwic2NvcGUiLCJpc1NlbGVjdG9ySW5TY29wZSIsInB1c2giLCJyZXBvcnRJZlJlcGVhdGVkU2VsZWN0aW9uc0ZvdW5kIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJzZWxlY3RvclRvTm9kZXMiLCJub2RlcyIsImxlbmd0aCIsInJlcG9ydCIsIm1lc3NhZ2VJZCIsImRhdGEiLCJ0aW1lcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQU1BOztBQUdBOztBQVNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLElBQUksR0FBRyx1QkFBYjs7O0FBRUEsTUFBTUMsVUFBVSxHQUFHQywrQkFBWUMsV0FBWixDQUNqQixNQUNFLDRGQUZlLENBQW5COztBQUtBLE1BQU1DLGFBQWEsR0FBRztBQUNwQkMsRUFBQUEsYUFBYSxFQUNYO0FBRmtCLENBQXRCOztBQUtBLE1BQU1DLElB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QSxJQUFJLEVBQUU7QUFBRWYsa0JBQUFBLFFBQUY7QUFBWWdCLGtCQUFBQSxLQUFLLEVBQUVMLEtBQUssQ0FBQ0M7QUFBekI7QUFITyxlQUFmO0FBS0Q7QUFDRixXQVJEO0FBU0QsU0FWRDtBQVdEO0FBN0NJLEtBQVA7QUErQ0Q7O0FBdERxQixDQUFELENBQXZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBUU0VTVHJlZSxcclxuICBFU0xpbnRVdGlscyxcclxuICBBU1RfTk9ERV9UWVBFUyxcclxufSBmcm9tICdAdHlwZXNjcmlwdC1lc2xpbnQvZXhwZXJpbWVudGFsLXV0aWxzJztcclxuXHJcbmltcG9ydCB7IGlzRnVuY3Rpb24gfSBmcm9tICdlc2xpbnQvbGliL3J1bGVzL3V0aWxzL2FzdC11dGlscyc7XHJcblxyXG5pbXBvcnQgeyBSdWxlTWV0YURhdGEsIEZ1bmN0aW9uIH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBnZXRBbmNlc3Rvck9mVHlwZSB9IGZyb20gJy4uL3V0aWxzL2FzdC11dGlscyc7XHJcblxyXG4vL1xyXG4vLyDilIDilIDilIAgVFlQRVMg4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAXHJcbi8vXHJcblxyXG50eXBlIFNlbGVjdG9yVG9Ob2RlcyA9IHsgW3NlbGVjdG9yOiBzdHJpbmddOiBUU0VTVHJlZS5Ob2RlW10gfTtcclxudHlwZSBTY29wZVRvU2VsZWN0b3JzID0geyBbc2NvcGU6IHN0cmluZ106IFNlbGVjdG9yVG9Ob2RlcyB9O1xyXG5cclxuLy9cclxuLy8g4pSA4pSA4pSAIFJVTEUgREVDTEFSQVRJT05TIOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgFxyXG4vL1xyXG5cclxuY29uc3QgbmFtZSA9ICdqcS1jYWNoZS1kb20tZWxlbWVudHMnO1xyXG5cclxuY29uc3QgY3JlYXRlUnVsZSA9IEVTTGludFV0aWxzLlJ1bGVDcmVhdG9yKFxyXG4gICgpID0+XHJcbiAgICAnaHR0cHM6Ly9naXRodWIuY29tL2Z1bGxzdGFjay1kZXZlbG9wbWVudC9mcm9udC1lbmQtYmVzdC1wcmFjdGljZXMvYmxvYi9tYXN0ZXIvSlMvalF1ZXJ5Lm1kJyxcclxuKTtcclxuXHJcbmNvbnN0IGVycm9yTWVzc2FnZXMgPSB7XHJcbiAgY2FjaGVET01Ob2RlczpcclxuICAgICdTZWxlY3RvciB7eyBzZWxlY3RvciB9fSB3YXMgdXNlZCB7eyB0aW1lcyB9fSB0aW1lcy4gVHJ5IGNhY2hpbmcgdGhpcyBET00gbm9kZSBpbnN0ZWFkJyxcclxufSBhcyBjb25zdDtcclxuXHJcbmNvbnN0IG1ldGE6IFJ1bGVNZXRhRGF0YTxrZXlvZiB0eXBlb2YgZXJyb3JNZXNzYWdlcz4gPSB7XHJcbiAgdHlwZTogJ3N1Z2dlc3Rpb24nLFxyXG4gIGRvY3M6IHtcclxuICAgIGNhdGVnb3J5OiAnQmVzdCBQcmFjdGljZXMnLFxyXG4gICAgZGVzY3JpcHRpb246ICdDYWNoZSBhbGwgc2VsZWN0ZWQgRE9NIGVsZW1lbnRzJyxcclxuICAgIHJlY29tbWVuZGVkOiBmYWxzZSxcclxuICB9LFxyXG4gIG1lc3NhZ2VzOiBlcnJvck1lc3NhZ2VzLFxyXG4gIHNjaGVtYTogW10sXHJcbn07XHJcblxyXG5jb25zdCBqcURPTVNlbGVjdG9yID1cclxuICAnTWVtYmVyRXhwcmVzc2lvbiA+IENhbGxFeHByZXNzaW9uID4gSWRlbnRpZmllci5jYWxsZWVbbmFtZT0vXFxcXCR8KGpRdWVyeSkvXSc7XHJcblxyXG5jb25zdCBydWxlID0gY3JlYXRlUnVsZSh7XHJcbiAgbmFtZSxcclxuICBtZXRhLFxyXG4gIGRlZmF1bHRPcHRpb25zOiBbXSxcclxuICBjcmVhdGUoY29udGV4dCkge1xyXG4gICAgY29uc3Qgc2NvcGVUb1NlbGVjdG9yczogU2NvcGVUb1NlbGVjdG9ycyA9IHt9O1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIFtqcURPTVNlbGVjdG9yXTogZnVuY3Rpb24gY2hlY2tET01TZWxlY3RvcihcclxuICAgICAgICBub2RlOiBUU0VTVHJlZS5JZGVudGlmaWVyLFxyXG4gICAgICApOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBmdW5jdGlvbkFuY2VzdG9yID0gZ2V0QW5jZXN0b3JPZlR5cGU8RnVuY3Rpb24+KGlzRnVuY3Rpb24sIG5vZGUpO1xyXG4gICAgICAgIGNvbnN0IHNjb3BlSWQgPSBmdW5jdGlvbkFuY2VzdG9yXHJcbiAgICAgICAgICA/IGAke2Z1bmN0aW9uQW5jZXN0b3IucmFuZ2Uuam9pbignLCcpfWAgLy8gbm8gMiBmdW5jdGlvbnMgY2FuIGhhdmUgc2FtZSByYW5nZVxyXG4gICAgICAgICAgOiAnZ2xvYmFsJztcclxuXHJcbiAgICAgICAgY29uc3QgY2FsbEV4cHJlc3Npb24gPSBub2RlLnBhcmVudCBhcyBUU0VTVHJlZS5DYWxsRXhwcmVzc2lvbjtcclxuICAgICAgICBjb25zdCBmaXJzdEFyZyA9IGNhbGxFeHByZXNzaW9uLmFyZ3VtZW50c1swXTtcclxuXHJcbiAgICAgICAgaWYgKGZpcnN0QXJnLnR5cGUgPT09IEFTVF9OT0RFX1RZUEVTLkxpdGVyYWwpIHtcclxuICAgICAgICAgIGlmICghZmlyc3RBcmcudmFsdWUpIHJldHVybjtcclxuXHJcbiAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IGZpcnN0QXJnLnZhbHVlLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgICAgLy8gaWYgc2VsZWN0b3IgaXMgaHRtbCBlbGVtZW50IHN0cmluZ1xyXG4gICAgICAgICAgaWYgKHNlbGVjdG9yLnN0YXJ0c1dpdGgoJzwnKSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHNjb3BlID0gc2NvcGVUb1NlbGVjdG9yc1tzY29wZUlkXTtcclxuICAgICAgICAgIGNvbnN0IGlzU2VsZWN0b3JJblNjb3BlID0gc2NvcGUgJiYgc2NvcGVbc2VsZWN0b3JdO1xyXG5cclxuICAgICAgICAgIGlmIChpc1NlbGVjdG9ySW5TY29wZSkge1xyXG4gICAgICAgICAgICBzY29wZVRvU2VsZWN0b3JzW3Njb3BlSWRdW3NlbGVjdG9yXS5wdXNoKGNhbGxFeHByZXNzaW9uKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoc2NvcGUpIHtcclxuICAgICAgICAgICAgc2NvcGVbc2VsZWN0b3JdID0gW2NhbGxFeHByZXNzaW9uXTtcclxuICAgICAgICAgICAgc2NvcGVUb1NlbGVjdG9yc1tzY29wZUlkXSA9IHNjb3BlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2NvcGVUb1NlbGVjdG9yc1tzY29wZUlkXSA9IHsgW3NlbGVjdG9yXTogW2NhbGxFeHByZXNzaW9uXSB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgJ1Byb2dyYW06ZXhpdCc6IGZ1bmN0aW9uIHJlcG9ydElmUmVwZWF0ZWRTZWxlY3Rpb25zRm91bmQoKTogdm9pZCB7XHJcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoc2NvcGVUb1NlbGVjdG9ycykuZm9yRWFjaCgoWywgc2VsZWN0b3JUb05vZGVzXSkgPT4ge1xyXG4gICAgICAgICAgT2JqZWN0LmVudHJpZXMoc2VsZWN0b3JUb05vZGVzKS5mb3JFYWNoKChbc2VsZWN0b3IsIG5vZGVzXSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAobm9kZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgIGNvbnRleHQucmVwb3J0KHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VJZDogJ2NhY2hlRE9NTm9kZXMnLFxyXG4gICAgICAgICAgICAgICAgbm9kZTogbm9kZXNbMF0sXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7IHNlbGVjdG9yLCB0aW1lczogbm9kZXMubGVuZ3RoIH0sXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9LFxyXG59KTtcclxuXHJcbmV4cG9ydCB7IG5hbWUsIHJ1bGUsIGVycm9yTWVzc2FnZXMgfTtcclxuIl19