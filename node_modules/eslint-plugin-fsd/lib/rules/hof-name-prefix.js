"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _astUtils = require("eslint/lib/rules/utils/ast-utils");

var _astUtils2 = require("../utils/ast-utils");

/**
 * @fileoverview Higher order function name prefix
 * @author Leonid Baryshnikov
 */
//------------------------------------------------------------------------------
// Rule Definition
//------------------------------------------------------------------------------
const rule = {
  meta: {
    type: 'layout',
    docs: {
      description: 'Higher order function name prefix',
      category: 'Stylistic Issues',
      recommended: false,
      url: 'https://github.com/timon-and-pumbaa/eslint-plugin-fsd/blob/master/docs/rules/hof-name-prefix.md'
    },
    fixable: undefined,
    schema: [],
    messages: {
      requireMake: 'Higher order function name should be prefixed with "make"'
    }
  },

  create(context) {
    const prefix = 'make'; //----------------------------------------------------------------------
    // Helpers
    //----------------------------------------------------------------------

    const reportIdentifier = identifier => {
      context.report({
        node: identifier,
        messageId: 'requireMake'
      });
    };

    const checkIdentifier = identifier => {
      const isPrefixCorrect = identifier.name.startsWith(prefix) || identifier.name.startsWith(`_${prefix}`);

      if (!isPrefixCorrect) {
        reportIdentifier(identifier);
      }
    };

    const getIdentifier = node => {
      const ancestorIsMethodOrProperty = node.type === 'MethodDefinition' || node.type === 'Property';
      const mayBeLeftProperty = node.type === 'AssignmentExpression' ? node.left.property : null;
      const mayBeKeyOrLeftProperty = ancestorIsMethodOrProperty ? node.key : mayBeLeftProperty;
      const identifier = node.type === 'VariableDeclarator' ? node.id : mayBeKeyOrLeftProperty;
      return identifier;
    };

    const isFunctionHigherOrder = node => {
      if (!node.body) return false;
      const functionBody = node.body; // When function body has no braces

      if ((0, _astUtils.isFunction)(functionBody)) return true;
      if (functionBody.type !== 'BlockStatement') return false;
      const {
        body: functionContent
      } = functionBody;
      const statementThatReturnsFunction = functionContent.find(contentNode => {
        const nodeReturnsFunction = contentNode.type === 'ReturnStatement' && contentNode.argument && (0, _astUtils.isFunction)(contentNode.argument);
        if (nodeReturnsFunction) return true;
        return false;
      });
      return !!statementThatReturnsFunction;
    };

    const checkFunctionDeclaration = node => {
      const functionIsHigherOrder = isFunctionHigherOrder(node);

      if (functionIsHigherOrder) {
        const identifier = node.id;
        checkIdentifier(identifier);
      }
    };

    const checkFunctionExpression = node => {
      const allowedAncestors = ['VariableDeclarator', 'MethodDefinition', 'AssignmentExpression', 'Property'];
      const parent = (0, _astUtils2.getParent)(context);
      if (!parent) return;
      const functionIsHigherOrder = isFunctionHigherOrder(node);

      if (allowedAncestors.includes(parent.type) && functionIsHigherOrder) {
        const identifier = getIdentifier(parent);
        checkIdentifier(identifier);
      }
    }; //----------------------------------------------------------------------
    // Public
    //----------------------------------------------------------------------


    return {
      FunctionDeclaration: checkFunctionDeclaration,
      FunctionExpression: checkFunctionExpression,
      ArrowFunctionExpression: checkFunctionExpression
    };
  }

};
var _default = rule;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvcnVsZXMvaG9mLW5hbWUtcHJlZml4LnRzIl0sIm5hbWVzIjpbInJ1bGUiLCJtZXRhIiwidHlwZSIsImRvY3MiLCJkZXNjcmlwdGlvbiIsImNhdGVnb3J5IiwicmVjb21tZW5kZWQiLCJ1cmwiLCJmaXhhYmxlIiwidW5kZWZpbmVkIiwic2NoZW1hIiwibWVzc2FnZXMiLCJyZXF1aXJlTWFrZSIsImNyZWF0ZSIsImNvbnRleHQiLCJwcmVmaXgiLCJyZXBvcnRJZGVudGlmaWVyIiwiaWRlbnRpZmllciIsInJlcG9ydCIsIm5vZGUiLCJtZXNzYWdlSWQiLCJjaGVja0lkZW50aWZpZXIiLCJpc1ByZWZpeENvcnJlY3QiLCJuYW1lIiwic3RhcnRzV2l0aCIsImdldElkZW50aWZpZXIiLCJhbmNlc3RvcklzTWV0aG9kT3JQcm9wZXJ0eSIsIm1heUJlTGVmdFByb3BlcnR5IiwibGVmdCIsInByb3BlcnR5IiwibWF5QmVLZXlPckxlZnRQcm9wZXJ0eSIsImtleSIsImlkIiwiaXNGdW5jdGlvbkhpZ2hlck9yZGVyIiwiYm9keSIsImZ1bmN0aW9uQm9keSIsImZ1bmN0aW9uQ29udGVudCIsInN0YXRlbWVudFRoYXRSZXR1cm5zRnVuY3Rpb24iLCJmaW5kIiwiY29udGVudE5vZGUiLCJub2RlUmV0dXJuc0Z1bmN0aW9uIiwiYXJndW1lbnQiLCJjaGVja0Z1bmN0aW9uRGVjbGFyYXRpb24iLCJmdW5jdGlvbklzSGlnaGVyT3JkZXIiLCJjaGVja0Z1bmN0aW9uRXhwcmVzc2lvbiIsImFsbG93ZWRBbmNlc3RvcnMiLCJwYXJlbnQiLCJpbmNsdWRlcyIsIkZ1bmN0aW9uRGVjbGFyYXRpb24iLCJGdW5jdGlvbkV4cHJlc3Npb24iLCJBcnJvd0Z1bmN0aW9uRXhwcmVzc2lvbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVVBOztBQUdBOztBQWJBOzs7O0FBS0E7QUFDQTtBQUNBO0FBY0EsTUFBTUEsSUFBMkMsR0FBRztBQUNsREMsRUFBQUEsSUFBSSxFQUFF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Q0FBQ2QsSUFBRCxDQUFuRDs7QUFFQSxVQUFJd0IscUJBQUosRUFBMkI7QUFDekIsY0FBTTFCLFVBQVUsR0FBR0UsSUFBSSxDQUFDYSxFQUF4QjtBQUVBWCxRQUFBQSxlQUFlLENBQUNKLFVBQUQsQ0FBZjtBQUNEO0FBQ0YsS0FWRDs7QUFZQSxVQUFNMkIsdUJBQXVCLEdBQzNCekIsSUFEOEIsSUFFckI7QUFDVCxZQUFNMEIsZ0JBQWdCLEdBQUcsQ0FDdkIsb0JBRHVCLEVBRXZCLGtCQUZ1QixFQUd2QixzQkFIdUIsRUFJdkIsVUFKdUIsQ0FBekI7QUFPQSxZQUFNQyxNQUFNLEdBQUcsMEJBQVVoQyxPQUFWLENBQWY7QUFFQSxVQUFJLENBQUNnQyxNQUFMLEVBQWE7QUFFYixZQUFNSCxxQkFBcUIsR0FBR1YscUJBQXFCLENBQUNkLElBQUQsQ0FBbkQ7O0FBRUEsVUFBSTBCLGdCQUFnQixDQUFDRSxRQUFqQixDQUEwQkQsTUFBTSxDQUFDNUMsSUFBakMsS0FBMEN5QyxxQkFBOUMsRUFBcUU7QUFDbkUsY0FBTTFCLFVBQVUsR0FBR1EsYUFBYSxDQUFDcUIsTUFBRCxDQUFoQztBQUVBekIsUUFBQUEsZUFBZSxDQUFDSixVQUFELENBQWY7QUFDRDtBQUNGLEtBckJELENBbEZ1QixDQXlHdkI7QUFDQTtBQUNBOzs7QUFFQSxXQUFPO0FBQ0wrQixNQUFBQSxtQkFBbUIsRUFBRU4sd0JBRGhCO0FBRUxPLE1BQUFBLGtCQUFrQixFQUFFTCx1QkFGZjtBQUdMTSxNQUFBQSx1QkFBdUIsRUFBRU47QUFIcEIsS0FBUDtBQUtEOztBQXJJaUQsQ0FBcEQ7ZUF3SWU1QyxJIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBmaWxlb3ZlcnZpZXcgSGlnaGVyIG9yZGVyIGZ1bmN0aW9uIG5hbWUgcHJlZml4XHJcbiAqIEBhdXRob3IgTGVvbmlkIEJhcnlzaG5pa292XHJcbiAqL1xyXG5cclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8gUnVsZSBEZWZpbml0aW9uXHJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5pbXBvcnQgeyBUU0VTVHJlZSwgVFNFU0xpbnQgfSBmcm9tICdAdHlwZXNjcmlwdC1lc2xpbnQvZXhwZXJpbWVudGFsLXV0aWxzJztcclxuaW1wb3J0IHsgaXNGdW5jdGlvbiB9IGZyb20gJ2VzbGludC9saWIvcnVsZXMvdXRpbHMvYXN0LXV0aWxzJztcclxuXHJcbmltcG9ydCB7IEZ1bmN0aW9uIH0gZnJvbSAnLi4vLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBnZXRQYXJlbnQgfSBmcm9tICcuLi91dGlscy9hc3QtdXRpbHMnO1xyXG5cclxudHlwZSBBbGxvd2VkQW5jZXN0b3JzID1cclxuICB8IFRTRVNUcmVlLlZhcmlhYmxlRGVjbGFyYXRvclxyXG4gIHwgVFNFU1RyZWUuTWV0aG9kRGVmaW5pdGlvblxyXG4gIHwgVFNFU1RyZWUuQXNzaWdubWVudEV4cHJlc3Npb25cclxuICB8IFRTRVNUcmVlLlByb3BlcnR5O1xyXG5cclxuY29uc3QgcnVsZTogVFNFU0xpbnQuUnVsZU1vZHVsZTxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcclxuICBtZXRhOiB7XHJcbiAgICB0eXBlOiAnbGF5b3V0JyxcclxuICAgIGRvY3M6IHtcclxuICAgICAgZGVzY3JpcHRpb246ICdIaWdoZXIgb3JkZXIgZnVuY3Rpb24gbmFtZSBwcmVmaXgnLFxyXG4gICAgICBjYXRlZ29yeTogJ1N0eWxpc3RpYyBJc3N1ZXMnLFxyXG4gICAgICByZWNvbW1lbmRlZDogZmFsc2UsXHJcbiAgICAgIHVybDpcclxuICAgICAgICAnaHR0cHM6Ly9naXRodWIuY29tL3RpbW9uLWFuZC1wdW1iYWEvZXNsaW50LXBsdWdpbi1mc2QvYmxvYi9tYXN0ZXIvZG9jcy9ydWxlcy9ob2YtbmFtZS1wcmVmaXgubWQnLFxyXG4gICAgfSxcclxuICAgIGZpeGFibGU6IHVuZGVmaW5lZCxcclxuICAgIHNjaGVtYTogW10sXHJcbiAgICBtZXNzYWdlczoge1xyXG4gICAgICByZXF1aXJlTWFrZTogJ0hpZ2hlciBvcmRlciBmdW5jdGlvbiBuYW1lIHNob3VsZCBiZSBwcmVmaXhlZCB3aXRoIFwibWFrZVwiJyxcclxuICAgIH0sXHJcbiAgfSxcclxuXHJcbiAgY3JlYXRlKFxyXG4gICAgY29udGV4dDogVFNFU0xpbnQuUnVsZUNvbnRleHQ8c3RyaW5nLCBzdHJpbmdbXT4sXHJcbiAgKTogVFNFU0xpbnQuUnVsZUxpc3RlbmVyIHtcclxuICAgIGNvbnN0IHByZWZpeCA9ICdtYWtlJztcclxuXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIC8vIEhlbHBlcnNcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIGNvbnN0IHJlcG9ydElkZW50aWZpZXIgPSAoaWRlbnRpZmllcjogVFNFU1RyZWUuSWRlbnRpZmllcik6IHZvaWQgPT4ge1xyXG4gICAgICBjb250ZXh0LnJlcG9ydCh7XHJcbiAgICAgICAgbm9kZTogaWRlbnRpZmllcixcclxuICAgICAgICBtZXNzYWdlSWQ6ICdyZXF1aXJlTWFrZScsXHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBjaGVja0lkZW50aWZpZXIgPSAoaWRlbnRpZmllcjogVFNFU1RyZWUuSWRlbnRpZmllcik6IHZvaWQgPT4ge1xyXG4gICAgICBjb25zdCBpc1ByZWZpeENvcnJlY3QgPVxyXG4gICAgICAgIGlkZW50aWZpZXIubmFtZS5zdGFydHNXaXRoKHByZWZpeCkgfHxcclxuICAgICAgICBpZGVudGlmaWVyLm5hbWUuc3RhcnRzV2l0aChgXyR7cHJlZml4fWApO1xyXG5cclxuICAgICAgaWYgKCFpc1ByZWZpeENvcnJlY3QpIHtcclxuICAgICAgICByZXBvcnRJZGVudGlmaWVyKGlkZW50aWZpZXIpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGdldElkZW50aWZpZXIgPSAobm9kZTogQWxsb3dlZEFuY2VzdG9ycyk6IFRTRVNUcmVlLklkZW50aWZpZXIgPT4ge1xyXG4gICAgICBjb25zdCBhbmNlc3RvcklzTWV0aG9kT3JQcm9wZXJ0eSA9XHJcbiAgICAgICAgbm9kZS50eXBlID09PSAnTWV0aG9kRGVmaW5pdGlvbicgfHwgbm9kZS50eXBlID09PSAnUHJvcGVydHknO1xyXG5cclxuICAgICAgY29uc3QgbWF5QmVMZWZ0UHJvcGVydHkgPVxyXG4gICAgICAgIG5vZGUudHlwZSA9PT0gJ0Fzc2lnbm1lbnRFeHByZXNzaW9uJ1xyXG4gICAgICAgICAgPyAobm9kZS5sZWZ0IGFzIFRTRVNUcmVlLk1lbWJlckV4cHJlc3Npb24pLnByb3BlcnR5XHJcbiAgICAgICAgICA6IG51bGw7XHJcblxyXG4gICAgICBjb25zdCBtYXlCZUtleU9yTGVmdFByb3BlcnR5ID0gYW5jZXN0b3JJc01ldGhvZE9yUHJvcGVydHlcclxuICAgICAgICA/IChub2RlIGFzIFRTRVNUcmVlLk1ldGhvZERlZmluaXRpb24gfCBUU0VTVHJlZS5NZXRob2REZWZpbml0aW9uKS5rZXlcclxuICAgICAgICA6IG1heUJlTGVmdFByb3BlcnR5O1xyXG5cclxuICAgICAgY29uc3QgaWRlbnRpZmllciA9XHJcbiAgICAgICAgbm9kZS50eXBlID09PSAnVmFyaWFibGVEZWNsYXJhdG9yJyA/IG5vZGUuaWQgOiBtYXlCZUtleU9yTGVmdFByb3BlcnR5O1xyXG5cclxuICAgICAgcmV0dXJuIGlkZW50aWZpZXIgYXMgVFNFU1RyZWUuSWRlbnRpZmllcjtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgaXNGdW5jdGlvbkhpZ2hlck9yZGVyID0gKG5vZGU6IEZ1bmN0aW9uKTogYm9vbGVhbiA9PiB7XHJcbiAgICAgIGlmICghbm9kZS5ib2R5KSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICBjb25zdCBmdW5jdGlvbkJvZHkgPSBub2RlLmJvZHkgYXMgVFNFU1RyZWUuQmxvY2tTdGF0ZW1lbnQgfCBGdW5jdGlvbjtcclxuXHJcbiAgICAgIC8vIFdoZW4gZnVuY3Rpb24gYm9keSBoYXMgbm8gYnJhY2VzXHJcbiAgICAgIGlmIChpc0Z1bmN0aW9uKGZ1bmN0aW9uQm9keSkpIHJldHVybiB0cnVlO1xyXG4gICAgICBpZiAoZnVuY3Rpb25Cb2R5LnR5cGUgIT09ICdCbG9ja1N0YXRlbWVudCcpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIGNvbnN0IHsgYm9keTogZnVuY3Rpb25Db250ZW50IH0gPSBmdW5jdGlvbkJvZHkgYXMgVFNFU1RyZWUuQmxvY2tTdGF0ZW1lbnQ7XHJcblxyXG4gICAgICBjb25zdCBzdGF0ZW1lbnRUaGF0UmV0dXJuc0Z1bmN0aW9uID0gZnVuY3Rpb25Db250ZW50LmZpbmQoXHJcbiAgICAgICAgKGNvbnRlbnROb2RlOiBUU0VTVHJlZS5Ob2RlKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBub2RlUmV0dXJuc0Z1bmN0aW9uID1cclxuICAgICAgICAgICAgY29udGVudE5vZGUudHlwZSA9PT0gJ1JldHVyblN0YXRlbWVudCcgJiZcclxuICAgICAgICAgICAgY29udGVudE5vZGUuYXJndW1lbnQgJiZcclxuICAgICAgICAgICAgaXNGdW5jdGlvbihjb250ZW50Tm9kZS5hcmd1bWVudCk7XHJcblxyXG4gICAgICAgICAgaWYgKG5vZGVSZXR1cm5zRnVuY3Rpb24pIHJldHVybiB0cnVlO1xyXG5cclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuICEhc3RhdGVtZW50VGhhdFJldHVybnNGdW5jdGlvbjtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgY2hlY2tGdW5jdGlvbkRlY2xhcmF0aW9uID0gKFxyXG4gICAgICBub2RlOiBUU0VTVHJlZS5GdW5jdGlvbkRlY2xhcmF0aW9uLFxyXG4gICAgKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IGZ1bmN0aW9uSXNIaWdoZXJPcmRlciA9IGlzRnVuY3Rpb25IaWdoZXJPcmRlcihub2RlKTtcclxuXHJcbiAgICAgIGlmIChmdW5jdGlvbklzSGlnaGVyT3JkZXIpIHtcclxuICAgICAgICBjb25zdCBpZGVudGlmaWVyID0gbm9kZS5pZDtcclxuXHJcbiAgICAgICAgY2hlY2tJZGVudGlmaWVyKGlkZW50aWZpZXIgYXMgVFNFU1RyZWUuSWRlbnRpZmllcik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgY2hlY2tGdW5jdGlvbkV4cHJlc3Npb24gPSAoXHJcbiAgICAgIG5vZGU6IFRTRVNUcmVlLkZ1bmN0aW9uRXhwcmVzc2lvbiB8IFRTRVNUcmVlLkFycm93RnVuY3Rpb25FeHByZXNzaW9uLFxyXG4gICAgKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IGFsbG93ZWRBbmNlc3RvcnMgPSBbXHJcbiAgICAgICAgJ1ZhcmlhYmxlRGVjbGFyYXRvcicsXHJcbiAgICAgICAgJ01ldGhvZERlZmluaXRpb24nLFxyXG4gICAgICAgICdBc3NpZ25tZW50RXhwcmVzc2lvbicsXHJcbiAgICAgICAgJ1Byb3BlcnR5JyxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIGNvbnN0IHBhcmVudCA9IGdldFBhcmVudChjb250ZXh0KTtcclxuXHJcbiAgICAgIGlmICghcGFyZW50KSByZXR1cm47XHJcblxyXG4gICAgICBjb25zdCBmdW5jdGlvbklzSGlnaGVyT3JkZXIgPSBpc0Z1bmN0aW9uSGlnaGVyT3JkZXIobm9kZSk7XHJcblxyXG4gICAgICBpZiAoYWxsb3dlZEFuY2VzdG9ycy5pbmNsdWRlcyhwYXJlbnQudHlwZSkgJiYgZnVuY3Rpb25Jc0hpZ2hlck9yZGVyKSB7XHJcbiAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IGdldElkZW50aWZpZXIocGFyZW50IGFzIEFsbG93ZWRBbmNlc3RvcnMpO1xyXG5cclxuICAgICAgICBjaGVja0lkZW50aWZpZXIoaWRlbnRpZmllcik7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyBQdWJsaWNcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIEZ1bmN0aW9uRGVjbGFyYXRpb246IGNoZWNrRnVuY3Rpb25EZWNsYXJhdGlvbixcclxuICAgICAgRnVuY3Rpb25FeHByZXNzaW9uOiBjaGVja0Z1bmN0aW9uRXhwcmVzc2lvbixcclxuICAgICAgQXJyb3dGdW5jdGlvbkV4cHJlc3Npb246IGNoZWNrRnVuY3Rpb25FeHByZXNzaW9uLFxyXG4gICAgfTtcclxuICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgcnVsZTtcclxuIl19